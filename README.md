# prisma-client-debugging

A minimal reproduction for TypeScript type checking problems occuring in the new "generated client" that comes with Prisma 6.6.0.

## Introduction

Upgrading Prisma / Prisma Client version `6.6.0` warns that in the future, invoking `prisma generate` will no longer generate the Prisma Client into the `node_modules` directory as has historically been the case, and that it will be required to specify an "output path" pointing to a directory where the generated client files will be placed. [Read more here](https://www.prisma.io/docs/orm/prisma-client/setup-and-configuration/generating-prisma-client#using-a-custom-output-path).

Also suggested is to switch from `prisma-client-js` to the new `prisma-client` client "provider in `schema.prisma:

```prisma
generator client {
    provider = "prisma-client-js"
    output   = "../src/generated/prisma"
}
```

becomes:

```prisma
generator client {
    provider = "prisma-client"
    output   = "../src/generated/prisma"
}
```

I have confirmed that this change does not affect or fix the issue I am about to describe. The issue occurs no matter whether using the old or new client.

The new client is generated as TypeScript files. These can be bundled into the app using Vite or ESBuild or the TypeScript compiler itself. Importing the new client is done as follows (the file extension is optional, depending on your Node.js version):

```ts
import { PrismaClient } from "./generated/prisma/client.js";
```

When running the TypeScript compiler in "[Project References](https://www.typescriptlang.org/docs/handbook/project-references.html#handbook-content)" mode (usually as a performance improvement or for better code organization in large projects), each "project" (unit of logical separation) must have its own `tsconfig.json` file, referenced in the "root" `tsconfig.json` file.

This minimal reproduction has just one project `foo` with its tsconfig file at `tsconfig.foo.json`, but it is possible and realistic in a real-world situation to add multiple, each with separate source files in `"include": []`, and different `"compilerOptions": {}`.

## The Problem

When using project references [it is required to set `"composite": true`](https://www.typescriptlang.org/docs/handbook/project-references.html#composite). As soon as this flag is set, TypeScript compilation / type checking no longer succeeds because of problems with the code generated by Prisma:

```bash
$ pnpm typecheck

> prisma-client-debugging@1.0.0 typecheck /home/jens/development/prisma-client-debugging
> tsc --build

src/generated/prisma/client.ts:341:16 - error TS4094: Property '_brand_DbNull' of exported anonymous class type may not be private or protected.

341   export const DbNull = runtime.objectEnumValues.instances.DbNull
                   ~~~~~~

  src/generated/prisma/client.ts:341:16
    341   export const DbNull = runtime.objectEnumValues.instances.DbNull
                       ~~~~~~
    Add a type annotation to the variable DbNull.

src/generated/prisma/client.ts:348:16 - error TS4094: Property '_brand_JsonNull' of exported anonymous class type may not be private or protected.

348   export const JsonNull = runtime.objectEnumValues.instances.JsonNull
                   ~~~~~~~~

  src/generated/prisma/client.ts:348:16
    348   export const JsonNull = runtime.objectEnumValues.instances.JsonNull
                       ~~~~~~~~
    Add a type annotation to the variable JsonNull.

src/generated/prisma/client.ts:355:16 - error TS4094: Property '_brand_AnyNull' of exported anonymous class type may not be private or protected.

355   export const AnyNull = runtime.objectEnumValues.instances.AnyNull
                   ~~~~~~~

  src/generated/prisma/client.ts:355:16
    355   export const AnyNull = runtime.objectEnumValues.instances.AnyNull
                       ~~~~~~~
    Add a type annotation to the variable AnyNull.


Found 3 errors.

 ELIFECYCLE  Command failed with exit code 1.
```

Thanks for reading, and I hope this helps to resolve the issue.
